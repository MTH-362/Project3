---
title: "Project3B"
author: "Tina Trinh, Ian Kramer, Mary Testa, and Ben Strougal"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

>INTRODUCTION:
> This data was retrieved from the Coffee Quality Database courtesy of Buzzfeed Data Scientist James LeDoux. The information was collected from the Coffee Quality Institute's review pages in January 2018. This data holds very detailed information over Arabica and Robusta beans, across many countries and they are professionally rated on a 0-100 scale. There are many rates/scores for things like acidity, sweetness, fragrance, balance, etc. Here is a brief explanation of all the variables included in the data frame with 1339 observations on the following 43 variables:

>total_cup_points - Total rating/points (0 - 100 scale)

>species	- Species of coffee bean (arabica or robusta)

>owner	- Owner of the farm

>country_of_origin	- Where the bean came from

>farm_name - Name of the farm

>lot_number - Lot number of the beans tested

>mill - Mill where the beans were processed

>ico_number - International Coffee Organization number

>company	- Company name

>altitude - this is a messy column - I've left it for some cleaning

>region - Region where bean came from

>producer - Producer of the roasted bean

>number_of_bags - Number of bags tested

>bag_weight - Bag weight tested

>in_country_partner - Partner for the country

>harvest_year	- When the beans were harvested (year)

>grading_date	- When the beans were graded

>owner_1 - Who owns the beans

>variety - Variety of the beans

>processing_method - Method for processing

>aroma - Aroma grade

>flavor	- Flavor grade

>aftertaste	- Aftertaste grade

>acidity - Acidity grade

>body	- Body grade

>balance	- Balance grade

>uniformity	- Uniformity grade

>clean_cup	- Clean cup grade

>sweetness	- Sweetness grade

>cupper_points	- Cupper Points

>moisture	- Moisture Grade

>category_one_defects	- Category one defects (count)

>quakers - quakers

>color - Color of bean

>category_two_defects	- Category two defects (count)

>expiration	- Expiration date of the beans

>certification_body	- Who certified it

>certification_address - Certification body address

>certification_contact - Certification contact

>unit_of_measurement	- Unit of measurement

>altitude_low_meters	- Altitude low meters

>altitude_high_meters	- Altitude high meters

>altitude_mean_meters	- Altitude mean meters

> Although this data is from 2018, the opportunity to discover the particular nuances that make coffee highly rated and delicious can be entertaining and interesting for personal coffee use. This information can serve as a guide in choosing high quality coffee beans and our analysis can be used to filter which factors are most important in influencing the total coffee rating. 

>Research Question: What factors may lead to a good
rating for coffee (total_cup_points)?

>Response Variable: Total rating/points, 0 - 100 scale(total_cup_points)

The analysis begins with a linear regression, because it is by far the simplest one to run and will likely expose issues that can be resolved by choosing a different model. It is very unlikely that the linear regression will produce substantive results, but it serves as a solid base to start the analysis from. 


hi

The ten variables to not use are:
aroma
flavor
aftertaste
acidity
body
balance
uniformity
clean_cup
sweetness
cupper_points


# EDA

We first check if the dataset contains any NA values and found that there's 3877 NA values. We then create a new clean dataset that omit the rows that has NA value and call that new dataset `coffee.clean`

```{r, include = FALSE}
# Check if there's any NA values
print(sum(is.na(coffee)))
```

```{r, include = FALSE}
# clean NA value, assign the clean dataset as coffee.clean
coffee.clean <- na.omit(coffee)

# verify if the dataset is clean
print(sum(is.na(coffee.clean)))
```

When we plot the distribution of the variable `Total.Cup.Points`, we see that distribution of the variable `Total.Cup.Points` is skewed to the left and unimodal. We can interpret this distribution as, in general, we have pretty high total rating points with the mean of around 82 points. The skewness of the distribution may suggest that there might be underlying interaction terms which are affecting the distribution of the variable. Note that there are 2 extreme outliers on this ditribution (based on the boxplot), so we'd use this distribution with caution.

```{r, echo = FALSE}
coffee.clean %>% ggplot(aes(x=Total.Cup.Points)) + geom_density()
coffee.clean %>% ggplot(aes(x=Total.Cup.Points)) + geom_boxplot()
print(mean(coffee.clean$Total.Cup.Points))
```


Since this dataset has multiple categorical variables, therefore, in order to simplifies the process of model selection. We assign the processing methods, color of the coffee, and country of origin as the table below 

| **Variable**      | **Description**                                                                                                                                                                                                                                                                        |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Country.Group     | Group of countries where the bean came from based on their continents:<br>1: Latin American Countries (El Salvador, Costa Rica, Guatemala, Honduras, Brazil, Mexico, Nicaragua)<br>2: African Countries (United Republic of Tanzania)<br>3: Asian Countries (Taiwan, Indonesia, China) |
| Processing.Method | Method for processing<br>1: Pulped natural / honey<br>2: Natural/Dry<br>3: Washed/Wet<br>4: Other                                                                                                                                                                                      |
| Color             | Color of the bean<br>0: Green<br>1: Blue-green<br>2: Bluish-green                                                                                                                                                                                                                      |



```{r, include=FALSE}

print(unique(coffee.clean$Country.of.Origin))
print(unique(coffee.clean$Processing.Method))

coffee.new <- coffee.clean %>% mutate(
  Processing.Method = case_when(
    Processing.Method == "Pulped natural / honey" ~ 1,
    Processing.Method == "Natural / Dry" ~ 2,
    Processing.Method == "Washed / Wet" ~ 3,
    Processing.Method == "Other" ~ 4),
  Color = case_when(
    Color == "Green" ~ 0,
    Color == "Blue-Green" ~ 1,
    Color == "Bluish-Green" ~ 2
  ),
  Country.Group = case_when(
    Country.of.Origin %in% c("El Salvador", "Costa Rica", "Guatemala", "Honduras", "Brazil", "Mexico", "Nicaragua") ~ 1,
    Country.of.Origin %in% c("Uganda", "Tanzania, United Republic Of") ~ 2,
    Country.of.Origin %in% c("Taiwan", "Indonesia", "China") ~ 3
  
  ))
glimpse(coffee.new)

```

Since we want to simplify the process of model selection, we'd exclude the variables that have string values and only focus on those with numerical values then assign this new dataset as `coffee.new`.

```{r, echo = FALSE}
coffee.new[,c('Species','...1','Owner','Country.of.Origin','Farm.Name','Lot.Number','Mill','ICO.Number','Company','Region',
                    'Producer','Bag.Weight','In.Country.Partner','Harvest.Year','Grading.Date','Owner.1','Variety','Expiration',
              'Certification.Body','Certification.Address','Certification.Contact','unit_of_measurement', 'Altitude','altitude_low_meters','altitude_high_meters','altitude_mean_meters')] <- list(NULL)
glimpse(coffee.new)

```

We've discussed that there might be some interaction terms that are affecting the distribution of the variable `Total.Cup.Points`, and based on the plot, it suggests that there may be an interaction between the variables 'Country.Group' and 'Flavor'. Specifically, the distribution of 'Total.Cup.Points' appears to vary across different levels of 'Flavor' within each level of 'Country.Group'. This suggests that the effect of 'Flavor' on 'Total.Cup.Points' may depend on the 'Country.Group', indicating a potential interaction between these two factors. 

```{r, echo = FALSE, warning = FALSE}


ggplot(data= coffee.new, aes(x = Flavor, y = Total.Cup.Points, fill = factor(Country.Group))) +
  geom_smooth(method = 'loess', formula = 'y~x')  + 
  labs(x = "Flavor", y = "Total Cup Points", fill = "Country Group") +
  theme_light()


```

